<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mangia & Fuggi – Menu</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto; background:#f6efe9; margin:0; padding:20px;}
    header{max-width:1100px;margin:0 auto 20px;display:flex;justify-content:space-between;align-items:center}
    .title{font-weight:700;font-size:28px;color:#7b4b3a}
    .container{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:1fr 340px;gap:18px}
    .card{background:#fff;border-radius:14px;padding:16px 18px;box-shadow:0 2px 10px rgba(0,0,0,.06)}
    h2{font-size:20px;margin:8px 0 12px;color:#7b4b3a}
    .item{display:grid;grid-template-columns:1fr auto 120px;gap:8px;align-items:center;padding:10px 0;border-bottom:1px dashed #e7d6c9}
    .name{font-weight:600}
    .desc{font-style:italic;color:#6b6b6b;font-size:14px}
    .price{font-weight:600;white-space:nowrap}
    .qty{display:flex;align-items:center;justify-content:flex-end;gap:10px}
    .btn{border:0;border-radius:22px;padding:6px 12px;background:#7b4b3a;color:#fff;cursor:pointer}
    .btn.small{padding:4px 10px;border-radius:16px}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .cart h3{margin:0 0 10px}
    .cart ul{list-style:none;padding:0;margin:0}
    .cart li{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #eee}
    .cart .tot{display:flex;justify-content:space-between;font-weight:700;margin-top:8px}
    @media (max-width:900px){.container{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header>
    <div class="title">Mangia &amp; Fuggi</div>
  </header>

  <div class="container">
    <main>
      <section class="card">
        <h2>Antipasti</h2>
        <div class="item" data-name="Bruschette" data-price="4.00">
          <div><div class="name">Bruschette</div><div class="desc">Pomodoro, basilico, olio EVO</div></div>
          <div class="price">€ 4,00</div>
          <div class="qty"><button class="btn small" onclick="dec('Bruschette')">−</button><span id="q-Bruschette">0</span><button class="btn small" onclick="inc('Bruschette',4.00)">+</button></div>
        </div>
        <div class="item" data-name="Olive & Taralli" data-price="3.50">
          <div><div class="name">Olive &amp; Taralli</div><div class="desc">Selezione tipica pugliese</div></div>
          <div class="price">€ 3,50</div>
          <div class="qty"><button class="btn small" onclick="dec('Olive & Taralli')">−</button><span id="q-Olive & Taralli">0</span><button class="btn small" onclick="inc('Olive & Taralli',3.50)">+</button></div>
        </div>
      </section>

      <section class="card">
        <h2>Pizze classiche</h2>
        <div class="item" data-name="Margherita" data-price="5.00">
          <div><div class="name">Margherita</div><div class="desc">Pomodoro, mozzarella, basilico</div></div>
          <div class="price">€ 5,00</div>
          <div class="qty"><button class="btn small" onclick="dec('Margherita')">−</button><span id="q-Margherita">0</span><button class="btn small" onclick="inc('Margherita',5.00)">+</button></div>
        </div>
        <div class="item" data-name="Diavola" data-price="7.00">
          <div><div class="name">Diavola</div><div class="desc">Salame piccante</div></div>
          <div class="price">€ 7,00</div>
          <div class="qty"><button class="btn small" onclick="dec('Diavola')">−</button><span id="q-Diavola">0</span><button class="btn small" onclick="inc('Diavola',7.00)">+</button></div>
        </div>
      </section>

      <section class="card">
        <h2>Bevande</h2>
        <div class="item" data-name="Acqua" data-price="1.50">
          <div><div class="name">Acqua</div><div class="desc">Naturale o frizzante</div></div>
          <div class="price">€ 1,50</div>
          <div class="qty"><button class="btn small" onclick="dec('Acqua')">−</button><span id="q-Acqua">0</span><button class="btn small" onclick="inc('Acqua',1.50)">+</button></div>
        </div>
        <div class="item" data-name="Birra" data-price="4.00">
          <div><div class="name">Birra</div><div class="desc">Chiara alla spina</div></div>
          <div class="price">€ 4,00</div>
          <div class="qty"><button class="btn small" onclick="dec('Birra')">−</button><span id="q-Birra">0</span><button class="btn small" onclick="inc('Birra',4.00)">+</button></div>
        </div>
      </section>
    </main>

    <aside class="card cart">
      <h3>Carrello</h3>
      <ul id="cart"></ul>
      <div class="tot"><span>Totale</span><span id="total">€ 0,00</span></div>
      <button class="btn" style="width:100%;margin-top:10px" onclick="checkout()">Conferma ordine</button>
    </aside>
  </div>

  <script>
    const cart = new Map();
    function inc(name, price){ const it = cart.get(name)||{price,qty:0}; it.qty++; cart.set(name,it); document.getElementById('q-'+name).textContent=it.qty; renderCart();}
    function dec(name){const it=cart.get(name)||{qty:0,price:0}; it.qty=Math.max(0,it.qty-1); if(it.qty===0)cart.delete(name); else cart.set(name,it); document.getElementById('q-'+name).textContent=it.qty||0; renderCart();}
    function euro(n){return "€ "+n.toFixed(2).replace(".",",");}
    function renderCart(){const ul=document.getElementById('cart'); ul.innerHTML=""; let tot=0; for(const [n,it] of cart.entries()){tot+=it.qty*it.price; const li=document.createElement('li'); li.innerHTML=`<span>${it.qty} × ${n}</span><span>${euro(it.qty*it.price)}</span>`; ul.appendChild(li);} document.getElementById('total').textContent=euro(tot);}
    async function checkout(){const items=Array.from(cart.entries()).map(([n,it])=>({name:n,price:it.price,qty:it.qty})); if(items.length===0)return alert("Aggiungi almeno un prodotto"); const tableCode=null; const total=items.reduce((s,i)=>s+i.price*i.qty,0); const r=await fetch("/api/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableCode,items,total})}); const js=await r.json(); if(js.ok){alert("Ordine inviato! ID: "+js.order_id); cart.clear(); renderCart(); document.querySelectorAll("[id^='q-']").forEach(e=>e.textContent="0");} else alert("Errore: "+(js.error||"Impossibile inviare"));}
  </script>
</body>
</html>
