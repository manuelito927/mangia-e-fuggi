<%
// Pre-elaborazioni sicure per evitare errori di sintassi dentro gli attributi
const rawName     = String(name || '');
const priceNum    = Number(price || 0);
const priceFixed  = priceNum.toFixed(2);
const priceLabel  = priceFixed.replace('.', ',');
// per l'ID aria e simili
const safeId      = rawName.toLowerCase().replace(/[^a-z0-9]+/gi,'_');
// per passare il nome dentro apici singoli in JS
const safeNameJs  = rawName.replace(/'/g, "\\'");
%>

<div
  class="item"
  data-name="<%= rawName %>"
  data-price="<%= priceFixed %>"
>
  <!-- FOTO -->
  <div class="thumb">
    <img
      src="<%= img || '/img/fallback.jpg' %>"
      alt="<%= rawName %>"
      loading="lazy"
      decoding="async"
      onerror="this.src='/img/fallback.jpg'">
  </div>

  <!-- TESTO -->
  <div class="i-left">
    <!-- Nome prodotto -->
    <div class="i-name" data-i18n-name="<%= rawName %>"><%= rawName %></div>

    <!-- Descrizione -->
    <% if (desc) { %>
      <div class="i-desc" data-i18n-desc="<%= desc %>"><em><%= desc %></em></div>
    <% } %>
  </div>

  <!-- PREZZO + QUANTITÀ -->
  <div class="i-right">
    <div class="i-price">€ <%= priceLabel %></div>

    <div class="i-qty" role="group" aria-label="Quantità per <%= rawName %>">
      <button
        type="button"
        class="q"
        aria-label="Diminuisci <%= rawName %>"
        onclick="dec('<%= safeNameJs %>')">−</button>

      <span
        class="qv"
        id="q-<%= safeId %>"
        aria-live="polite"
        aria-atomic="true">0</span>

      <button
        type="button"
        class="q"
        aria-label="Aumenta <%= rawName %>"
        onclick="inc('<%= safeNameJs %>', <%= priceNum %>)">+</button>
    </div>
  </div>
</div>

<script>
  // Dizionario base (prima della logica che lo usa)
  const translations = {
    en: {
      "Bruschette": "Bruschetta",
      "Pomodoro, basilico, olio EVO": "Tomato, basil, extra virgin olive oil",
      "Olive & Taralli": "Olives & Taralli",
      "Selezione tipica pugliese": "Typical Apulian selection",
      "Caprese": "Caprese salad",
      "Mozzarella, pomodoro, origano": "Mozzarella, tomato, oregano",
      "Parmigiana": "Eggplant parmigiana",
      "Melanzane, pomodoro, grana": "Eggplant, tomato, parmesan cheese",
      "Fritto misto": "Mixed fried starters",
      "Arancini, crocchè, panelle": "Rice balls, potato croquettes, chickpea fritters"
      // continuerai qui con tutte le voci da menu.ejs
    }
  };

  // Traduzione dinamica di nome e descrizione se lingua = 'en'
  (function () {
    const currentLang = localStorage.getItem('lang') || 'it';
    if (currentLang !== 'en') return;

    document.querySelectorAll('[data-i18n-name]').forEach(el => {
      const key = el.getAttribute('data-i18n-name');
      if (translations.en && translations.en[key]) el.textContent = translations.en[key];
    });

    document.querySelectorAll('[data-i18n-desc]').forEach(el => {
      const key = el.getAttribute('data-i18n-desc');
      if (translations.en && translations.en[key]) {
        el.innerHTML = '<em>' + translations.en[key] + '</em>';
      }
    });
  })();
</script>